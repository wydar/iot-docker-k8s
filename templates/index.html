{% extends "base_layout.html" %}
{% block body %}
    <div class="container">
        <h1>Trying mqtt with flask</h1>
        <!--SHOW ONLY IN DESKTOP-->
        <div class="row" id="desktop">
            <div class="col-md-3">
                <div class="scrollbox">
                    <h4>Temperatura</h4>
                    <ul class="temp">
                        <li>Datos</li>
                    </ul>
                </div>                
            </div>
            <div class="col-md-3">
                <div class="scrollbox">
                    <h4>Humedad</h4>
                    <ul class="hum">
                        <li>Datos</li>
                    </ul>
                </div>                
            </div>
            <div class="col-md-3">
                <div class="scrollbox">
                    <h4>Luminosidad</h4>
                    <ul class="volt">
                        <li>Datos</li>
                     </ul>
                </div>
            </div>
            <div class="col-md-3">
                <p>
                    Alice was beginning to get very tired of sitting by her sister
                        on the bank, and of having nothing to do:  once or twice she had
                        peeped into the book her sister was reading, but it had no
                        pictures or conversations in it, `and what is the use of a book,'
                        thought Alice `without pictures or conversation?'
                        
                        So she was considering in her own mind (as well as she could,
                        for the hot day made her feel very sleepy and stupid), whether
                        the pleasure of making a daisy-chain would be worth the trouble
                        of getting up and picking the daisies, when suddenly a White
                        Rabbit with pink eyes ran close by her.
                    </p>
            </div>
        </div>
      </div>

      <!--SHOW ONLY IN MOBILES-->
      <div class="panel-group" id="accordion">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a id="temp-m" data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                  Temperatura</a>
                </h4>
              </div>
              <div id="collapse1" class="panel-collapse collapse in">
                <div class="panel-body">
                    <ul class="temp">
                        <li>Datos</li>
                    </ul>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a id="hum-m" data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                  Humedad</a>
                </h4>
              </div>
              <div id="collapse2" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="hum">
                        <li>Datos</li>
                    </ul>
               </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h4 class="panel-title">
                  <a id="volt-m" data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                  Luminosidad</a>
                </h4>
              </div>
              <div id="collapse3" class="panel-collapse collapse">
                <div class="panel-body">
                    <ul class="volt">
                        <li>Datos</li>
                    </ul>
                </div>
              </div>
            </div>
          </div>


    <script>
        if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
            $('#desktop').css('display', 'none');
        }else{
            $('#accordion').css('display', 'none'); 
        }
    </script>

    <script>
        const socket = io();
        
        socket.on('mqtt_message',function(data){
            console.log(data);
            if(data.topic=="humidity"){
                $('.hum').prepend('<li>'+ data.topic + ' ' + data.payload +'</li>');
                $('#hum-m').text('Humedad: '+data.payload);
            }else if(data.topic=="temperature"){
                $('.temp').prepend('<li>'+ data.topic + ' ' + data.payload +'</li>');
                $('#temp-m').text('Temperatura: '+data.payload);
            }else if(data.topic=="voltage"){
                $('.volt').prepend('<li>'+ data.topic + ' ' + data.payload +'</li>');
                $('#volt-m').text('Luminosidad: '+data.payload);
            }
            
        })
    </script>
{% endblock %}